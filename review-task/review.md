# Review task
Имеем исходный код:
```php
<?
class UserCommand extends CConsoleCommand {
    public function actionIndex() {
        foreach(User::model()->findAll() as $row)
        { $row->password=md5($this->rand_str());$row->save(); }
    }
    public function rand_str($length=3) {
        $temp = 'abcdefghijklmnopqrstuvwxyz'; $tmp_var = isset($length) ? $length + 0 : -1; for ($i = 0; $i <= $length; $i++)
        $randomString .= $temp[rand(1, strlen($temp) - 1)]; return $randomString;
    } }
?>
```

Код с замечаниями:
```php
<?
// psr: Использован короткий открывающий тэг. Нарушение PSR-1(основным стандартам кодирования по php): Файлы ДОЛЖНЫ использовать только <?php и <?= теги.
class UserCommand extends CConsoleCommand { 
// critical: Допущена ошибка в названии класса-родителя, вероятно имелся ввиду "ConsoleCommand"
// nit: Название команды не отражает ее сути, лучше будет назвать чем-то вроде "RegenerateAllUserPasswords"
    public function actionIndex() { // nit: Именование метода больше похоже на action контроллера, лучше назвать чем-то вроде "handle/execute"
        foreach(User::model()->findAll() as $row)
        // critical: при таком подходе в оперативную память будет выгружена вся таблицы из базы данных, что приведет к падению скрипта по памяти. Нужно использовать порционную загрузку данных
        // psr: Наружен PSR-2: https://www.php-fig.org/psr/psr-2/#5-control-structures Нужно правильно расставить скобки управляющей конструкции "foreach"
        { $row->password=md5($this->rand_str());$row->save(); } // business: возможно пострадают конечные пользователи, так как при таком подходе мы заберем доступы не только у злоумышленников, но и у пользователей, и им придется восстанавливать пароль. Возможно стоит сразу отправлять пользователю его новый пароль.
        // nit: Выбран ненадежный с точки зрения коллизий метод md5, в данном случае может быть оправдано с точки зрения необходимости по быстрому отобрать доступы у злоумышленников, тем не менее лучше сразу выбрать более устойчивый к коллизиям шифр, например sha256.
    }
    public function rand_str($length=3) { //nit: неплохо было бы явно указать тип принимаемых данных, и расставить пробелы около "=", перенести "{" на новую строку
        // nit: способ генерации случайной строки переусложнен. Можно использовать нативную функцию "random_bytes" для генерации основы хэша и полностью отказаться от метода.
        $temp = 'abcdefghijklmnopqrstuvwxyz'; //nit: использована статическая строка для генерации случайной строки, это влияет на количество коллизий хэша. Если пользователей много - шанс выписать им одинаковые пароли - достаточно велик.
         $tmp_var = isset($length) ? $length + 0 : -1; for ($i = 0; $i <= $length; $i++)
        $randomString .= $temp[rand(1, strlen($temp) - 1)]; return $randomString;
        // psr: во всем методы необходимо расставить переносы строк после символа ";"
    } } // psr: закрывающая скобка класса должна находиться на новой строке
// Не рекомендуется закрывать код php, это может привести к буферизации случайно поставленного пробела после него, и как следствие проблемы при отдаче контента страницы. (Контент будет передан раньше заголовков)
?>
```
